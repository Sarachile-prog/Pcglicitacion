{
  "entities": {
    "BidOpportunity": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "BidOpportunity",
      "type": "object",
      "description": "Represents a single bid opportunity scraped from various sources, including its key details, deadlines, and associated entities.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the BidOpportunity entity."
        },
        "title": {
          "type": "string",
          "description": "The title or subject of the bid opportunity."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the bid opportunity."
        },
        "originalUrl": {
          "type": "string",
          "description": "The URL to the original source document or webpage of the bid.",
          "format": "uri"
        },
        "publicationDate": {
          "type": "string",
          "description": "The date and time when the bid opportunity was officially published.",
          "format": "date-time"
        },
        "submissionDeadline": {
          "type": "string",
          "description": "The final date and time for submitting proposals or bids.",
          "format": "date-time"
        },
        "estimatedAmount": {
          "type": "number",
          "description": "The estimated monetary value of the contract or project, if available."
        },
        "currency": {
          "type": "string",
          "description": "The currency in which the estimated amount is denominated (e.g., 'USD', 'EUR', 'CLP')."
        },
        "status": {
          "type": "string",
          "description": "The current status of the bid opportunity (e.g., 'Open', 'Closed', 'Awarded', 'Canceled')."
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to the Category this bid opportunity belongs to. (Relationship: Category 1:N BidOpportunity)"
        },
        "issuingEntityId": {
          "type": "string",
          "description": "Reference to the GovernmentEntity that issued this bid. (Relationship: GovernmentEntity 1:N BidOpportunity)"
        },
        "requirementsSummary": {
          "type": "string",
          "description": "A summarized version of the key requirements for the bid, extracted and potentially enhanced by AI."
        },
        "reasoningToolOutput": {
          "type": "string",
          "description": "The output or reasoning generated by the GenAI tool to enhance comprehension of the bid details."
        }
      },
      "required": [
        "id",
        "title",
        "originalUrl",
        "publicationDate",
        "submissionDeadline",
        "status",
        "categoryId",
        "issuingEntityId"
      ]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Defines a classification category for bid opportunities, such as 'Construction', 'IT Services', or 'Consulting'.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Category entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the bid category (e.g., 'Infrastructure', 'Software Development', 'Health')."
        },
        "description": {
          "type": "string",
          "description": "A brief explanation of the types of bids included in this category."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "GovernmentEntity": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GovernmentEntity",
      "type": "object",
      "description": "Represents a government body, public institution, or other official entity that issues bid opportunities.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the GovernmentEntity entity."
        },
        "name": {
          "type": "string",
          "description": "The full name of the government or institutional entity (e.g., 'Ministerio de Obras PÃºblicas')."
        },
        "type": {
          "type": "string",
          "description": "The type of the entity (e.g., 'National Government', 'Regional', 'Municipal', 'Public Company')."
        },
        "country": {
          "type": "string",
          "description": "The country where the entity is located or primarily operates."
        },
        "contactEmail": {
          "type": "string",
          "description": "The primary contact email address for the entity, if available.",
          "format": "email"
        },
        "website": {
          "type": "string",
          "description": "The official website of the entity, if available.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "name",
        "type",
        "country"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/bidOpportunities/{bidOpportunityId}",
        "definition": {
          "entityName": "BidOpportunity",
          "schema": {
            "$ref": "#/backend/entities/BidOpportunity"
          },
          "description": "Stores all scraped bid opportunities. This collection is designed for public readability, allowing all users to browse bid details. Documents include `categoryId` and `issuingEntityId` for direct querying and relationship clarity, without requiring complex authorization checks on parent entities.",
          "params": [
            {
              "name": "bidOpportunityId",
              "description": "Unique identifier for a specific bid opportunity."
            }
          ]
        }
      },
      {
        "path": "/categories/{categoryId}",
        "definition": {
          "entityName": "Category",
          "schema": {
            "$ref": "#/backend/entities/Category"
          },
          "description": "Contains predefined categories for bid opportunities. This collection is publicly readable, serving as a lookup for categorizing bids. Access is independent, and no denormalized authorization fields are required as all categories share the same access posture.",
          "params": [
            {
              "name": "categoryId",
              "description": "Unique identifier for a specific bid category."
            }
          ]
        }
      },
      {
        "path": "/governmentEntities/{governmentEntityId}",
        "definition": {
          "entityName": "GovernmentEntity",
          "schema": {
            "$ref": "#/backend/entities/GovernmentEntity"
          },
          "description": "Stores information about government and institutional entities that issue bids. This collection is publicly readable, providing reference data for bid opportunities. Its security posture is homogeneous, requiring no denormalized authorization fields.",
          "params": [
            {
              "name": "governmentEntityId",
              "description": "Unique identifier for a specific government entity."
            }
          ]
        }
      }
    ],
    "reasoning": "The recommended Firestore structure for 'Licitaciones Globales' prioritizes public readability and clear segregation of data types, aligning with core design principles for security, scalability, and debuggability.\n\nEach core entity (`BidOpportunity`, `Category`, `GovernmentEntity`) is placed in its own top-level collection. This design assumes that the scraped bid data, categories, and government entities are primarily public-facing and universally accessible for read operations by authenticated (or even unauthenticated, if the rules allow) users. This approach significantly simplifies security rules and enhances debuggability by making the access intent explicit for each collection.\n\n**Authorization Independence:** The design achieves authorization independence by eliminating the need for hierarchical authorization dependencies. Since `BidOpportunity`, `Category`, and `GovernmentEntity` are modeled as largely public data (or at least, all documents within a collection share the same read access pattern), security rules do not require `get()` calls to parent or related documents to determine access. For instance, a `BidOpportunity`'s readability does not depend on attributes of its `Category` or `GovernmentEntity`. This structure allows for atomic operations (though not directly relevant for public read access, it's a foundational benefit) and makes security rules concise and easy to audit. There is no denormalization specifically for *authorization* needed within these core entities because their access is universal; if granular per-user private data were introduced (e.g., 'saved bids'), then path-based ownership (`/users/{uid}/savedBids`) would be used, and the `uid` in the path would serve as the denormalized authorization context.\n\n**Querying for Authorization (QAPs):** By structurally segregating each entity into its own top-level collection, we ensure a homogeneous security posture within each collection. For example, all documents in `/bidOpportunities` are subject to the same read rules. This enables secure `list` operations (QAPs). Security rules can simply grant or deny read access to the entire collection (e.g., `allow read: if true;` for public data, or `allow read: if request.auth != null;` for authenticated access). Clients can then perform efficient queries on any indexed fields within these collections (e.g., `bidOpportunities.where('categoryId', '==', 'someCategory')`) without the security rules attempting to filter results based on individual document content or relationships. The rules enforce what a user *can see* from the collection, not *what data to show* after filtering. This ensures that any data returned by a query is inherently authorized, minimizing the risk of data leakage and improving query performance by leveraging Firestore's native indexing capabilities rather than rule-based filtering."
  }
}